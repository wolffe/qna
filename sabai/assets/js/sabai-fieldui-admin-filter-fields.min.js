(function(a){SABAI.FieldUI=SABAI.FieldUI||{};SABAI.FieldUI.adminFields=function(f){var f=a.extend({submitConfirm:"",leaveConfirm:"",deleteFieldConfirm:""},f),k=false,j,h,m=function(n){var o=a(this);SABAI.ajax({type:"get",container:"#sabai-modal",url:this.href+(this.href.indexOf("?",0)===-1?"?":"&")+"&field_id="+o.data("field-id"),onError:function(q,r,p){SABAI.flash(q.message,"danger")},onContent:function(p,r,q){r.focusFirstInput()},trigger:o,modalWidth:600});return false},b=function(o){var p=a(this),n=a(this).closest(".sabai-fieldui-field"),q=n.find(".sabai-fieldui-field-id").attr("value"),r=n.attr("id");SABAI.ajax({type:"get",container:"#sabai-modal",url:this.href+(this.href.indexOf("?",0)===-1?"?":"&")+"ele_id="+r+"&filter_id="+q,onContent:function(s,u,t){u.focusFirstInput()},onError:function(t,u,s){SABAI.flash(t.message,"danger")},trigger:p,modalWidth:600});i(n);return false},g=function(n){var o=a(this).closest(".sabai-fieldui-field");i(o);if(!confirm(f.deleteFieldConfirm)){return false}if(o.find(".sabai-fieldui-field-id").attr("value")){j=setTimeout(function(){a("#sabai-fieldui").submit()},2000)}o.fadeTo("fast",0,function(){a(this).slideUp("medium",function(){a(this).remove()})});return false},e=function(p,n){if(!n.hide_label&&n.label){p.find("> .sabai-fieldui-field-label").html(n.required?n.label+'<span class="sabai-fieldui-field-required">*</span>':n.label).show()}else{p.find("> .sabai-fieldui-field-label").hide()}if(n.description){p.find("> .sabai-fieldui-field-description").html(n.description).show()}else{p.find("> .sabai-fieldui-field-description").hide()}var o=n.label+" - "+n.name;p.find("> .sabai-fieldui-field-preview").html(n.preview).end().find(".sabai-fieldui-field-title").text(o).end().find(".sabai-fieldui-field-edit").attr("data-modal-title",o).end().effect("highlight",{},2000)},i=function(n){l();n.addClass("sabai-fieldui-field-selected")},l=function(n){a("#sabai-fieldui").find(".sabai-fieldui-field-selected").removeClass("sabai-fieldui-field-selected")},d={items:".sabai-fieldui-field",handle:".sabai-fieldui-field-info",connectWith:"#sabai-fieldui-active .sabai-fieldui-fields",helper:"clone",opacity:0.8,cursor:"move",placeholder:"sabai-fieldui-field-placeholder",start:function(n,o){l();o.placeholder.width(o.helper.outerWidth()-2).height(o.helper.outerHeight()-2);if(j){clearTimeout(j);j=null}a("#sabai-fieldui-active > div.sabai-row-fluid").addClass("sabai-fieldui-placeholder")},update:function(n,o){o.item.addClass("sabai-fieldui-moved");if(!j){j=setTimeout(function(){a("#sabai-fieldui").submit()},2000)}},stop:function(n,o){a("#sabai-fieldui-active > div.sabai-row-fluid").removeClass("sabai-fieldui-placeholder")}},c=function(o){if(j){clearTimeout(j);j=null}var n=SABAI.parseUrl(window.location.toString());n.query[this.name]=this.value;n.search=a.param(n.query);SABAI.ajax({type:"get",container:"#sabai-content",url:n.toString(),onError:function(q,r,p){SABAI.flash(q.message,"danger")},onContent:function(p,r,q){SABAI.FieldUI.adminFields(f)},pushState:true});j=setTimeout(function(){a("#sabai-fieldui").submit()},2000);return false};a("#sabai-fieldui-active > div.sabai-row-fluid").first().addClass("sabai-row-fluid-first");a("#sabai-fieldui-active > div.sabai-row-fluid").last().addClass("sabai-row-fluid-last");a(".sabai-fieldui-available.sabai-fieldui-fields").on("click",".sabai-fieldui-content > a",m);a(".sabai-fieldui-available.sabai-fieldui-layout").on("change",".sabai-fieldui-content > select",c);a(".sabai-fieldui-field-control").on("click",".sabai-fieldui-field-edit",b).on("click",".sabai-fieldui-field-delete",g);a("#sabai-fieldui-active .sabai-fieldui-fields").sortable(d);a(".sabai-fieldui-available > .sabai-fieldui-title").click(function(){var o=a(this),n=o.closest(".sabai-fieldui-available").find(".sabai-fieldui-content");if(n.is(":hidden")){n.slideDown("fast");o.find("a.sabai-fieldui-toggle i").removeClass("fa-caret-down").addClass("fa-caret-up")}else{n.slideUp("fast");o.find("a.sabai-fieldui-toggle i").removeClass("fa-caret-up").addClass("fa-caret-down")}return false});a("#sabai-fieldui").submit(function(){var n=a(this);l(true);k=true;SABAI.ajax({type:n.attr("method"),container:n,url:n.attr("action")+"&"+n.serialize(),onSuccess:function(o,q,p){q.find(".sabai-fieldui-moved").removeClass("sabai-fieldui-moved")},onError:function(p,q,o){SABAI.flash(p.message,"danger")},loadingImage:false});return false});window.onbeforeunload=function(){if(k){k=false;return}if(a("#sabai-fieldui").find(".sabai-fieldui-moved").length){return f.leaveConfirm}};h=a("#sabai-fieldui-available-wrap").offset();a(window).scroll(function(){if(a(window).scrollTop()>h.top-40){a("#sabai-fieldui-available-wrap").css({position:"fixed",top:"40px",left:h.left+"px"})}else{a("#sabai-fieldui-available-wrap").css("position","static")}});a(window).resize(function(){a("#sabai-fieldui-available-wrap").css("position","static");h.left=a("#sabai-fieldui-available-wrap").offset().left;if(a(window).scrollTop()>h.top-40){a("#sabai-fieldui-available-wrap").css({position:"fixed",top:"40px",left:h.left+"px"})}});a(SABAI).bind("fieldui_filter_created.sabai",function(q,o){o.target.hide();var n=a("#sabai-fieldui-active").find(".sabai-fieldui-fields").first();if(!n.length){return}var p=a("#sabai-fieldui-field").clone(true).attr("id","sabai-fieldui-field"+o.result.id).appendTo(n).find(".sabai-fieldui-field-id").attr("value",o.result.id).end().find(".sabai-fieldui-field-help").remove().end().addClass("sabai-fieldui-field-type-"+o.result.type_normalized).show();SABAI.scrollTo(p);e(p,o.result);a("#sabai-fieldui").submit();i(p)});a(SABAI).bind("fieldui_filter_updated.sabai",function(p,n){n.target.hide();var o=a("#"+n.result.ele_id);SABAI.scrollTo(o);e(o,n.result)})}})(jQuery);