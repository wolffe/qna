(function(a){SABAI.File=SABAI.File||{};SABAI.File.upload=SABAI.File.upload||function(d){var d=a.extend({selector:"",maxNumFiles:0,maxNumFileExceededError:"",paramName:"sabai_file",inputName:"files",sortable:true,formData:{}},d),f=0,e=a(d.selector);if(!e.length){alert(1);return}var g=e.closest(".sabai-form-fields"),b=g.find(".sabai-progress"),c=b.find(".sabai-progress-bar");e.fileupload({url:d.url,dataType:"json",paramName:d.paramName,formData:d.formData,singleFileUploads:true,submit:function(h,i){if(d.maxNumFiles&&f+i.files.length>d.maxNumFiles){if(d.maxNumFileExceededError){alert(d.maxNumFileExceededError)}return false}c.attr("aria-valuenow",0).css("width","0%").text("0%");b.show()},fail:function(i,h){b.hide();SABAI.flash(h.result.error,"danger")},done:function(j,i){b.hide();if(i.result.error){SABAI.flash(i.result.error,"danger");return}f+=i.result.files.length;var h=g.find(".sabai-file-current table");a.each(i.result.files,function(l,m){var k="<tr class='sabai-file-row'><td class='sabai-form-check'><input name='"+d.inputName+"[current]["+m.id+"][check][]' type='checkbox' value='"+m.id+"' checked='checked'></td><td>";if(m.thumbnail){k+="<img src='"+m.thumbnail+"' alt='' />"}else{k+="<i class='fa "+m.icon+"'></i>"}k+="</td><td><input name='"+d.inputName+"[current]["+m.id+"][name]' type='text' value='"+m.title+"' /></td><td>"+m.size_hr+"</td></tr>";if(!h.has(".sabai-file-row").length){h.find("tbody").html(k).effect("highlight",{},2000)}else{a(k).appendTo(h.find("tbody")).effect("highlight",{},2000)}});if(d.sortable){SABAI.init(h.find("tbody").sortable("destroy").sortable({containment:"parent",axis:"y"}).parent())}},progressall:function(j,i){var h=parseInt(i.loaded/i.total*100,10);c.attr("aria-valuenow",h).css("width",h+"%").text(h+"%")}});a(d.form).submit(function(){if(d.maxNumFiles&&g.find(".sabai-file-current tbody input[type='checkbox']:checked").length>d.maxNumFiles){if(d.maxNumFileExceededError){alert(d.maxNumFileExceededError)}return false}});if(d.sortable){g.find(".sabai-file-current tbody").sortable({containment:"parent",axis:"y"})}}})(jQuery);