var SABAI=SABAI||{};!function(e){var a,t;if(SABAI.console=window.console||{log:function(e){alert(e)}},SABAI.isRTL=!1,SABAI.init=function(a,t){var i,n;i=a,SABAI.fadeout(e(".sabai-fadeout",i)),e("input.sabai-form-check-trigger",a).show().click(function(){var a=e(this);a.closest("table").find("input.sabai-form-check-target, input.sabai-form-check-trigger").not(":disabled").prop("checked",a.prop("checked"))}),e("fieldset.sabai-form-collapsible",a).not(".sabai-form-collapsible-processed").each(function(){var a=e(this);a.find("> legend span:first").prepend('<i class="fa fa-caret-down"></i> ').wrap('<a class="sabai-form-collapsible" href="#"></a>').end().find("a.sabai-form-collapsible:first").click(function(){return e(this).toggleClass("sabai-form-collapsed").find("i").toggleClass("fa-caret-down").toggleClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right").end().closest(".sabai-form-collapsible-processed").toggleClass("sabai-form-collapsed").find(".sabai-form-fields:first").slideToggle("fast",function(){autosize(e(this).find("textarea:visible"))}),!1}).end().addClass("sabai-form-collapsible-processed"),a.hasClass("sabai-form-collapsed")&&(a.hasClass("sabai-form-field-error")?a.removeClass("sabai-form-collapsed"):a.find(".sabai-form-fields:first").css({display:"none"}).end().find("a.sabai-form-collapsible:first").addClass("sabai-form-collapsed").find("i").removeClass("fa-caret-down").addClass(SABAI.isRTL?"fa-caret-left":"fa-caret-right"))}),autosize(e("textarea:visible",a)),n=a,"ontouchstart"in document.documentElement||e('[rel="sabaitooltip"]',n).each(function(){var a=e(this),t="sabai-content"===n.attr("id")&&a.closest("#sabai-inline-content").length?a.closest("#sabai-inline-content"):a.data("container")||n;a.sabaitooltip({container:t})}),e("a[data-popover-url]",n).bind("click",function(a){var t=e(this).unbind("hover"),i={html:!0,container:"sabai-content"===n.attr("id")&&t.closest("#sabai-inline-content").length?t.closest("#sabai-inline-content"):t.data("container")||n,url:t.data("popover-url")};SABAI.isRTL?i.placement=function(a,t){return e(t).offset().left>300?"left":"auto"}:i.placement=function(a,t){var i=e(t);return window.innerWidth-(i.offset().left+i.innerWidth())>300?"right":"auto"},SABAI.popover(t,i),a.preventDefault()}),e("a.sabai-toggle",a).not(".sabai-toggle-processed").unbind("click").click(function(a){var t=e(this).addClass("sabai-toggle-processed"),i=e(t.data("toggle-target"));if(e.trim(i.html())){e(SABAI).trigger("toggle.sabai",{trigger:t,target:i});var n=t.data("toggle-cookie"),s=t.hasClass("sabai-toggle-slide")?"slideToggle":"toggle";i[s]("fast",function(){var a=i.is(":visible");t.toggleClass("sabai-active",a),n&&e.cookie(n,a?1:0,{path:SABAI.path,domain:SABAI.domain}),e(SABAI).trigger("toggled.sabai",{trigger:t,target:i})}),a.preventDefault()}}),e(".sabai-carousel",a).each(function(){var a=e(this);a.data("carousel",a.bxSlider(a.data("carousel-options")||{})),e(SABAI).bind("entity_filter_form_toggled.sabai",function(e,t){a.parents(t.container).length&&a.data("carousel").redrawSlider()})}),e("a.sabai-form-field-add",a).each(function(){var a=e(this),t=a.closest(".sabai-form-fields"),i=parseInt(a.data("field-max-num"));a.click(function(e){var n=a.data("field-next-index");SABAI.cloneField(t,a.data("field-name"),i,n,a),n&&a.data("field-next-index",++n),e.preventDefault()}),t.find("> .sabai-form-field:not(.sabai-form-field-add)").each(function(n){0!==n&&e(this).append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').find("a.sabai-form-field-remove").click(function(n){e(this).closest(".sabai-form-field").fadeTo("fast",0,function(){e(this).slideUp("fast",function(){e(this).remove(),i&&t.find("> .sabai-form-field:not(.sabai-form-field-add)").length<i&&a.show()})}),n.preventDefault()}).parent().css("position","relative")}),i&&t.find("> .sabai-form-field:not(.sabai-form-field-add)").length>=i&&a.hide()}),"function"==typeof prettyPrint&&prettyPrint(),"function"==typeof e.fn.prettyPhoto&&e('a[rel^="prettyPhoto"]',a).prettyPhoto(),e(".sabai-dropdown-toggle",a).sabaidropdown(),e(".sabai-click",a).click(),t&&t.call(null,a),e(SABAI).trigger("sabai_init.sabai",{context:a})},SABAI.fadeout=function(a,t){t=t||6e3,e(a).animate({opacity:"+=0"},t,function(){e(this).fadeOut("fast",function(){e(this).remove()})})},SABAI.cache=(a={},function(e,t,i){if(1==arguments.length)return!!a[e]&&!(a[e].expires<(new Date).getTime())&&a[e].data;i=i||600,a[e]={data:t,expires:(new Date).getTime()+1e3*i}}),SABAI.flash=function(a,t,i){if(void 0!==a&&null!==a)if("string"==typeof a)e.growl(a,{type:t,delay:"danger"===t?0:void 0!==i?i:5e3,z_index:999999});else for(var n=0;n<a.length;n++)SABAI.flash(a[n].msg,a[n].level,i)},SABAI.load=function(a,t,i){var n=e(a);return n.load(t,{__ajax:a},function(e,a,t){SABAI.init(n),i&&i.call(n,e,a,t)}),n},SABAI.replace=function(a,t,i,n){var s;return e.get(t,{__ajax:a},function(t,o,r){n?s=e(a).html(t):(e(a).replaceWith(t),s=e(a)),SABAI.init(s),i&&i.call(null,s,t,o,r)}),s},SABAI.popover=function(a,t,i){if(a=a instanceof jQuery?a:e(a),i||!a.hasClass("sabai-popover-processed")){if((t=t||{}).template='<div class="sabai-popover"><div class="sabai-arrow"></div><div class="sabai-popover-inner"><div class="sabai-close"><i class="fa fa-times"></i></div><div class="sabai-popover-title"></div><div class="sabai-popover-content"></div></div></div>',t.url){var n=SABAI.cache(t.url);n?t.content=n:(t.content="&nbsp;",e.get(t.url,{__ajax:1},function(e){SABAI.cache(t.url,e),a.attr("data-content",e).data("bs.sabaipopover").tip().find(".sabai-popover-content").html(e),a.sabaipopover("show")}))}a.sabaipopover(t).sabaipopover("show").addClass("sabai-popover-processed").data("bs.sabaipopover").tip().css(t.width?{width:t.width}:{}).find(".sabai-close").on("click",function(){a.data("bs.sabaipopover").hide()}),SABAI.popoverInit||(e("body").on("click",function(a){e(".sabai-popover-processed").each(function(){e(this).is(a.target)||0!==e(this).has(a.target).length||0!==e(".sabai-popover").has(a.target).length||e(this).sabaipopover("hide")})}),SABAI.popoverInit=!0)}},SABAI.modal=function(a,i,n,s){var o,r,l,c,d,f;return s?t=s:e("body").has("#sabai-modal").length?t=e("#sabai-modal"):(o=e('<div class="sabai" id="sabai-modal" style="display:none;"><div class="sabai-modal-container"><div class="sabai-modal-title"><span></span><span class="sabai-close"><i class="fa fa-times"></i></span></div><div class="sabai-modal-content"></div><div class="sabai-modal-footer"></div></div></div>').prependTo("body").find(".sabai-close").mousedown(function(){e("#sabai-modal").fadeOut("fast",function(){e(this).remove()})}).end(),e(document).keyup(function(a){27==a.keyCode&&e("#sabai-modal").find(".sabai-close").mousedown()}),t=o),(i||a)&&(i&&t.find(".sabai-modal-title > span:first").text(i),a&&t.find(".sabai-modal-content").html(a),t.show()),void 0!==n&&(0===n&&(n=t.find(".sabai-modal-container").width()),r=t,l=n,f=document.documentElement.clientWidth<=768?.95:.8,(null===l||l>document.documentElement.clientWidth*f)&&(l=document.documentElement.clientWidth*f),r.find(".sabai-modal-container").css({width:l+"px",left:SABAI.isRTL?"auto":document.documentElement.clientWidth/2-l/2,right:SABAI.isRTL?document.documentElement.clientWidth/2-l/2:"auto",top:.07*document.documentElement.clientHeight}),d=r.find(".sabai-form-buttons").length?r.find(".sabai-form-buttons").outerHeight()+10:20,r.find(".sabai-modal-footer").css("height",d+"px"),c=.8*document.documentElement.clientHeight-r.find(".sabai-modal-title").outerHeight()-d,r.find(".sabai-modal-content").css("max-height",c+"px"),r.get(0).scrollHeight>document.documentElement.clientHeight&&r.find(".sabai-modal-content").css("height",c+"px")),t},SABAI.ajaxLoader=function(a,t,i){var n=e(a);if(i){var s=e(i);if(!s.length)return;if(t)s.next(".sabai-ajax-loader").remove();else{var o=e('<div class="sabai-ajax-loader"></div>').css("top",parseInt(s.position().top,10)+parseInt(s.css("margin-top"),10)+"px").width(s.outerWidth()).height(s.outerHeight());s.after(o)}n.length&&n.blur().prop("disabled",!t).css("pointer-events",t?"auto":"none")}else{if(!n.length)return;n.blur().prop("disabled",!t).css("pointer-events",t?"auto":"none").toggleClass("sabai-ajax-loading",!t)}},SABAI.ajax=function(a){var t,i,n,s=e.extend({trigger:null,async:!0,type:"get",url:"",data:"",processData:!0,target:"",container:null,modalWidth:null,cache:!1,cacheLifetime:600,onSendData:null,onSuccess:null,onError:null,onErrorFlash:!0,onContent:null,onSuccessFlash:!1,onReadyState:null,effect:null,scroll:!1,replace:!1,highlight:!1,callback:!1,loadingImage:!0,position:!1,toggle:!1,pushState:!1,state:{}},a),o="",r=0,l=function(a,t){if("#sabai-modal"===s.container){if(s.trigger){var i=s.trigger.attr("data-modal-title");void 0!==i&&!1!==i||(i=s.trigger.attr("title")||s.trigger.attr("data-original-title")||""),SABAI.modal(a,i,s.modalWidth,t)}else SABAI.modal(a,"",s.modalWidth,t);s.onContent||(s.onContent=function(e,a,t){a.focusFirstInput()}),s.onContent(a,t,s.trigger)}else{if(s.trigger&&s.trigger.hasClass("sabai-toggle")&&e(SABAI).trigger("toggle.sabai",{trigger:s.trigger,target:t}),s.replace)s.scroll&&o&&SABAI.scrollTo(o),t=t.hide().after(a).remove().next(),s.onContent&&s.onContent(a,t,s.trigger);else{switch(s.callback||"sabai-content"==t.attr("id")||"sabai-inline-content"==t.attr("id")||t.addClass("sabai-ajax"),s.effect){case"slide":t.hide().html(a).slideDown("fast",function(){s.onContent&&s.onContent(a,t,s.trigger)});break;default:t.html(a).show(),s.onContent&&s.onContent(a,t,s.trigger)}s.scroll&&o&&SABAI.scrollTo(o)}if(s.highlight&&t.effect("highlight",{},1500),s.trigger&&s.trigger.hasClass("sabai-toggle")){var n=t.is(":visible");s.trigger.removeAttr("onclick").removeClass("sabai-click").toggleClass("sabai-active",n);var r=s.trigger.data("toggle-cookie");r&&e.cookie(r,n?1:0,{path:SABAI.path,domain:SABAI.domain}),e(SABAI).trigger("toggled.sabai",{trigger:s.trigger,target:t})}}if(s.pushState&&window.history&&window.history.pushState){var l=SABAI.parseUrl(s.url);l.pathname!==location.pathname&&(l.pathname=location.pathname),s.state.data=s.data,s.state.url=s.url,s.state.container=s.container,s.state.target=s.target,window.history.pushState(s.state,null,l.toString())}SABAI.init(t),e(SABAI).trigger("loaded.sabai",{target:t,selector:o})};if(s.trigger){if(s.trigger.hasClass("sabai-disabled"))return;s.trigger.data("cookie-name")&&s.trigger.data("cookie-value")&&e.cookie(s.trigger.data("cookie-name"),s.trigger.data("cookie-value"),{path:SABAI.path,domain:SABAI.domain}),s.url||(s.url=s.trigger.data("sabai-remote-url")),s.trigger.hasClass("sabai-dropdown-link")&&(s.trigger=s.trigger.closest(".sabai-btn-group").find(".sabai-dropdown-toggle"))}if(s.url){if(s.container)if(o=s.container,"#sabai-modal"===s.container)t=SABAI.modal();else if(s.target?(t=e(s.container).find(s.target),o=s.container+" "+s.target):t=e(s.container),!t.length)return void SABAI.console.log(o);if(s.cache&&"get"===s.type){var c=SABAI.cache(s.container+s.url);if(c)return void l(c,t)}s.onSendData&&("object"!=typeof s.data&&(s.data={}),s.onSendData(s.data,s.trigger)),"object"==typeof s.data?(s.data.hasOwnProperty("__ajax")||(s.data.__ajax=o||1),s.data=e.param(s.data)):"string"==typeof s.data&&""!==s.data?s.data+="&__ajax="+(o?encodeURIComponent(o):1):s.data="__ajax="+(o?encodeURIComponent(o):1),e.ajaxreadystate({global:!0,async:s.async,type:s.type,dataType:"html",url:s.url,data:s.data,processData:s.processData,cache:!1,beforeSend:function(e){s.loadingImage&&(t&&"sabai-content"!==t.attr("id")&&t.is(":visible")?(i="sabai-modal"===t.attr("id")?t.find(".sabai-modal-content"):t,SABAI.ajaxLoader(s.trigger,!1,i)):SABAI.ajaxLoader(s.trigger))},complete:function(a,r){switch(s.loadingImage&&SABAI.ajaxLoader(s.trigger,!0,s.replace?o:i),r){case"success":if(void 0!==n){s.loadingImage&&SABAI.ajaxLoader(s.trigger,!0);break}278==a.status||a.getResponseHeader("content-type").indexOf("json")>-1?function(a,t){try{var i=JSON.parse(a.replace(/<!--[\s\S]*?-->/g,""));if(s.onSuccess&&!s.onSuccess(i,t,s.trigger))return void(s.onSuccessFlash&&i.messages&&SABAI.flash(i.messages,"success"));if(i.url)return"#sabai-modal"===s.container&&e("#sabai-modal").hide(),void(window.location=i.url);s.onSuccessFlash&&i.messages&&SABAI.flash(i.messages,"success")}catch(e){SABAI.console.log("Failed parsing response:<p>"+a.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+e.toString()+"</p>")}}(a.responseText,t):(l(a.responseText,t),"get"==s.type&&s.cache&&SABAI.cache(s.container+s.url,a.responseText,s.cacheLifetime));break;case"error":!function(e,a){try{var t=JSON.parse(e.replace(/<!--[\s\S]*?-->/g,""));if(s.onError){if(!s.onError(t,a,s.trigger))return void(s.onErrorFlash&&t.messages&&SABAI.flash(t.messages,"danger"))}else if(t.url)return void(window.location=t.url);s.onErrorFlash&&t.messages&&(s.trigger?(SABAI.popover(s.trigger,{content:t.messages[0],html:!0,container:s.trigger.closest(".sabai"),title:s.trigger.attr("data-sabaipopover-title")||""}),s.trigger.attr("onclick","return false;")):SABAI.flash(t.messages,"danger"))}catch(a){SABAI.console.log("Failed parsing response:<p>"+e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</p><p>"+a.toString()+"</p>")}}(a.responseText,t)}},readystate:function(e,a){if(s.onReadyState&&a>2&&a<4&&-1!==e.getResponseHeader("Content-Type").indexOf("application/json")){++r;var i=void 0!==n?e.responseText.substring(n.length):e.responseText;try{var o=JSON.parse(i.replace(/<!--[\s\S]*?-->/g,""));s.onReadyState(o,t,s.trigger,r)}catch(e){SABAI.console.log(e.toString())}n=e.responseText}}})}},SABAI.scrollTo=function(a,t,i){a=a instanceof jQuery?a:e(a),t=void 0!==t&&null!==t?t:1e3,i=void 0!==i&&null!==i?i:0,e.sabaiScrollTo(a,t,{offset:{top:i}})},SABAI.states=function(a,t){var i=[],n={visible:"invisible",enabled:"disabled",unchecked:"checked",unload_options:"load_options",show_options:"hide_options"},s=function(a,t,n,s){var r=e(a,s);r.length&&r.each(function(){var a,r,l,c,d,f,u,g=e(this);g.data("guid")||g.data("guid",SABAI.guid());for(a in n)if(c=n[a],f=".sabai-cloned",(l=g.closest(f)).length||(f=c.container||"form",l=g.closest(f)),l.length)if((r=l.find(a)).length){switch(d=["initialized.sabai"],c.type){case"selected":case"unselected":d.push("change","cloneremoved.sabai");break;case"checked":case"unchecked":d.push("change","cloneremoved.sabai","switchChange.bootstrapSwitch");break;case"focus":case"blur":d.push("focus","blur");break;case"request":case"requested":d.push("requested.sabai");break;case"values":case"count":default:d.push("keyup","change","cloneremoved.sabai")}i.push(r);for(var h=0;h<d.length;h++)u=d[h]+"."+g.data("guid"),r.off(u).on(u,function(e,a,t,i,n,s){return function(r,l){o(e,a,t,i,n,s,r.type,l)}}(r,g,t,n,s,f))}else console.log("Invalid or non existent dependee selector: "+a);else console.log("Invalid or non existent container selector: .sabai-cloned, "+(c.container||"form"))})},o=function(e,a,t,i,s,o,l,d){var f,u,g,h;if(t.match(/_or$/)){f=!1,t=t.slice(0,t.length-3);for(u in i){if(h=i[u],!(g=a.closest(o).find(u)).length)return;if(r(g,h.type||"value",h.value)){f=!0;break}}}else{f=!0;for(u in i){if(h=i[u],!(g=a.closest(o).find(u)).length)return;if(!r(g,h.type||"value",h.value)){f=!1;break}}}t in n&&(t=n[t],f=!f),c(a,t,f,e,l,d)},r=function(a,t,i){switch(t){case"value":case"values":"object"!=typeof i&&(i=[i]);var n=[];a.each(function(){if("checkbox"===this.type||"radio"===this.type)this.checked&&n.push(this.value);else{var a=e(this);if(a.hasClass("sabai-form-selecthierarchical")){var t=a.closest(".sabai-form-type-select").next(".sabai-form-type-select:visible");if(t.length&&""!==t.find("select").val())return!0}n.push(a.val())}});var s=i.length,o=n.length;e:for(var r=0;r<s;r++){for(var c=0;c<o;c++)if("object"!=typeof i[r]){if(i[r]==n[c]){if("value"===t)return!0;continue e}}else if(l(i[r][0],n[c],i[r][1])){if("value"===t)return!0;continue e}if("values"===t)return!1}return"values"===t;case"count":n=[];return a.each(function(){"checkbox"===this.type||"radio"===this.type?this.checked&&n.push(this.value):n.push(e(this).val())}),n.length===i;case"checked":case"unchecked":var d=!1;return a.each(function(){if(e(this).prop("checked")===Boolean(i))return d=!0,!1}),"checked"===t?d:!d;case"empty":case"filled":case"selected":d=!1;return a.each(function(){if(""===e.trim(e(this).val())===Boolean(i))return d=!0,!1}),"empty"===t?d:!d;case"request":return a.data("request-url")&&a.data("request-result")===i;case"requested":return!!a.data("request-url")&&("success"===(d=a.data("request-result"))||"error"===d)===Boolean(i);case"focus":return a.is(":focus")===Boolean(i);case"blur":return a.is(":focus")!==Boolean(i);default:return alert("Invalid condition type: "+t),!1}},l=function(e,a,t){switch(t){case"==":return e==a;case"!=":return e!=a;case"<":return e<a;case">":return e>a}},c=function(a,t,i,n,s,o){switch(t){case"invisible":a.toggleClass("sabai-form-states-invisible",i),i?o?a[a.hasClass("sabai-has-error")?"show":"hide"]():a.hide():a.is(":hidden")&&(o?a.show():(a.css("opacity",0).slideDown(100).animate({opacity:1},{queue:!1,duration:"slow"}),a.hasClass("sabai-form-field")&&a.parent(".sabai-form-inline").length&&a.css("display","inline-block")));break;case"disabled":a.toggleClass("sabai-form-states-disabled",i);break;case"checked":a.find(":checkbox").prop("checked",i).change();break;case"load_options":if("change"!==s&&"initialized"!==s)return;var r=a.find("select");if(r.find('option[value!=""]').remove(),i){var l=r.data("load-url"),c=l+n.val(),d=SABAI.cache(c),f=r.data("options-prefix")||"",u=function(t){if(SABAI.cache(c,t),void 0!==t&&0===t.length)return r.data("show-empty")||a.addClass("sabai-hidden"),r.data("default-value","").val(""),void r.trigger("change",[o]);if(e.each(t,function(a,t){r.append(e("<option></option>").text(f+t[1]).val(t[0]))}),!a.closest(".sabai-cloned").length){var i=r.data("default-value");void 0!==i&&(r.val(i),r.trigger("change",[o]))}if(!a.hasClass("sabai-form-states-invisible")&&a.is(":hidden")&&r.find('option[value!=""]').length){a.removeClass("sabai-hidden").addClass("sabai-was-hidden");var n=a.hasClass("sabai-form-field")&&a.parent(".sabai-form-inline").length?"inline":"block";o?a.css("display",n):a.hide().css("display",n).fadeIn("fast")}};!1!==d?u(d):(n.addClass("sabai-ajax-loading"),e.getJSON(l,{value:n.val()},u).always(function(){n.removeClass("sabai-ajax-loading")}))}else!a.is(":hidden")&&a.hasClass("sabai-was-hidden")&&(a.addClass("sabai-hidden"),r.data("default-value","").val(""),r.trigger("change",[o]));break;case"request_url":i?SABAI.ajax({target:a,url:a.data("request-url"),onSuccess:function(e,t,i){a.data("request-result","success").trigger("requested.sabai")},onError:function(e,t,i){a.data("request-result","error").trigger("requested.sabai")},onContent:function(e,t,i){a.data("request-result","error").trigger("requested.sabai")}}):a.data("request-result","");break;case"hide_options":var g=[];if(n.each(function(){"checkbox"===this.type||"radio"===this.type?this.checked&&g.push(this.value):g.push(e(this).val())}),!i||!g.length)return;a.find("input").each(function(){var a=e(this),t=a.data("values"),i=a.closest(".sabai-radio, .sabai-checkbox");if(i.length){for(var n=0;n<g.length;n++)if(-1!==e.inArray(g[n],t))return void i.slideDown(100);"checkbox"!==this.type&&"radio"!==this.type||(this.checked=!1),i.hide()}});break;case"slugify":o||a.find("input").val(n.val()).change();break;default:alert("Invalid action: "+t)}};for(var d in a)for(var f in a[d])s(d,f,a[d][f].conditions,t);for(var u in i)i[u].data("initialized")||i[u].trigger("initialized.sabai",[!0]).data("initialized",!0)},SABAI.cloneField=function(a,t,i,n,s){var o=e(a),r=o.find("> .sabai-form-field:not(.sabai-form-field-add)"),l=n||r.length;if(!(i&&r.length>=i)){var c=r.first(),d=c.clone().addClass("sabai-cloned").attr("id","sabai-"+SABAI.guid()).find(":input").each(function(){var a=jQuery(this);a.attr("name")&&(field_name=s.data("field-form-wrap")?s.data("field-form-wrap")+"["+t+"]":t,a.attr("name",a.attr("name").replace(field_name+"[0]",field_name+"["+l+"]"))),a.attr("id")&&a.attr("id",a.attr("id")+"-"+l),a.removeData("default-value").removeAttr("data-default-value"),e.fn.uniform&&a.parent().is(".selector")&&a.prev("span").remove().end().unwrap().uniform().parent(".selector").show()}).end().clearInput().removeClass("sabai-form-field-error").find("span.sabai-form-field-error").remove().end().find(".sabai-was-hidden").hide().end().hide().insertAfter(r.last());d.append('<a class="sabai-btn sabai-btn-danger sabai-btn-xs sabai-form-field-remove" href="#"><i class="fa fa-times" title="Remove this field"></i></a>').slideDown("fast").focusFirstInput().find("a.sabai-form-field-remove").click(function(a){e(this).closest(".sabai-form-field").fadeTo("fast",0,function(){e(this).slideUp("fast",function(){e(this).remove();var a=o.find("> .sabai-form-field:not(.sabai-form-field-add)");i&&a.length<i&&s.show(),a.find(":input").trigger("cloneremoved.sabai")})}),a.preventDefault()}).parent().css("position","relative"),e(SABAI).trigger("clonefield.sabai",{container:a,field:c,clone:d,index:l}),i&&s&&l+1>=i&&s.hide()}},SABAI.addOption=function(a,t,i,n,s){var o=e(a),r=e(i).closest(".sabai-form-field-option"),l=o.find("> .sabai-form-field-option"),c=n?t+"[default][]":t+"[default]",d=r.find("input[name='"+c+"']").val(),f=r.clone().find(":text").each(function(){var e=jQuery(this);e.attr("name")&&e.attr("name",e.attr("name").replace(t+"[options]["+d+"]",t+"[options]["+l.length+"]"))}).end().clearInput().find("input[name='"+c+"']").val(l.length).end().hide().insertAfter(r);return s&&s.call(null,f),f.slideDown("fast").focusFirstInput(),!1},SABAI.removeOption=function(a,t,i){var n=e(a).find("> .sabai-form-field-option:not(.sabai-form-field-option-disabled)");if(1!==n.length)return!!confirm(i)&&void e(t).closest(".sabai-form-field-option").slideUp("fast",function(){e(this).remove()});n.clearInput()},SABAI.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)})},window.history&&window.history.pushState){var i=!1,n=window.location.href.replace(/%2F/g,"/");e(window).on("popstate",function(a){if(i||(i=!0,location.href.replace(/%2F/g,"/")!=n)){var t=a.originalEvent.state;t?(t.data.__ajax=t.target?t.container+" "+t.target:t.container,SABAI.ajax(t),e(SABAI).trigger("sabaipopstate.sabai",t)):(e(window).off("popstate"),window.location.href=window.location.href)}})}SABAI.parseUrl=function(a){var t=a?e("<a/>").prop("href",a)[0]:window.location;if(t.query={},t.search&&"string"==typeof t.search){var i=t.search.substr(1).replace(/\+/g,"%20").split("&");e.each(i,function(e,a){var i=a.split("=");try{i[1]=decodeURIComponent(i[1])}catch(e){}t.query[i[0]]=i[1]})}return t},SABAI.getScript=function(a,t,i){return t=e.extend(t||{},{dataType:"script",cache:!0,url:a}),jQuery.ajax(t,i)},e.fn.sabai=function(){SABAI.init(this)},e.fn.focusTextRange=function(e,a){if(this.is('input[type="text"]')||this.is("textarea")){var t=this.get(0);if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,a);else if(t.createTextRange){var i=t.createTextRange();i.collapse(!0),i.moveEnd("character",a),i.moveStart("character",e),i.select()}}return this},e.fn.focusFirstInput=function(){var e=this.find('input[type="text"],input[type="password"],textarea').not(".sabai-focus-off").filter(":visible:first");if(!e.length)return this;var a=e.val().length;return e.focusTextRange(a,a),this},e.fn.clearInput=function(){return this.each(function(){var a=e(this),t=a.get(0).tagName.toLowerCase();if(void 0===a.data("default-value"))if("input"===t){var i=a.attr("type");"checkbox"===i||"radio"===i?a.prop("checked",!1):a.val("")}else if("textarea"===t)a.val("");else{if("select"!==t)return a.find(":input").clearInput();a.prop("selectedIndex",0)}else a.val(a.data("default-value"))})}}(jQuery);